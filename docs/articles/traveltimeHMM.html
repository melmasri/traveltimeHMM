<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to traveltimeHMM: making reliable travel time predictions on road networks • traveltimeHMM</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to traveltimeHMM: making reliable travel time predictions on road networks">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">traveltimeHMM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/traveltimeHMM.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/melmasri/traveltimeHMM">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><script src="traveltimeHMM_files/kePrint-0.0.1/kePrint.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Introduction to traveltimeHMM: making reliable travel time predictions on road networks</h1>
                        <h4 class="author">Mohamad Elmasri, Aurélie Labbe, Denis Larocque, Laurent Charlin and Éric Germain</h4>
            
            <h4 class="date">2020-11-25</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/melmasri/traveltimeHMM/blob/master/vignettes/traveltimeHMM.Rmd"><code>vignettes/traveltimeHMM.Rmd</code></a></small>
      <div class="hidden name"><code>traveltimeHMM.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>In the new world of data, decision-making is becoming more data-driven then ever. This is increasingly true for urban transportation, where the ubiquitous expected time of arrival (ETA) is heavily used. Providing reliability measure for ETA’s is likely to improve our understanding of travel time and to provide systems with better decision-making metrics. This <code>traveltimeHMM</code> package provides various methods to estimate the distribution of travel time on a given route, by leveraging GPS data from moving vehicles on road segments, with flexible temporal binning.</p>
<p>Implemented methods include the proposed TRIP model (and its variates) in Woodard et. al. (2016). Other methods are in the pipeline.</p>
<p>This is a work in progress. For bugs and features, please refer to <a href="https://github.com/melmasri/traveltimeHMM/issues">here</a>.</p>
</div>
<div id="example-data-set-tripset" class="section level1">
<h1 class="hasAnchor">
<a href="#example-data-set-tripset" class="anchor"></a>Example data set: <code>tripset</code>
</h1>
<p>This package includes a small data set (<code>tripset</code>) that aggregates map-matched anonymized mobile phone GPS data collected in Quebec city in 2014 using the Mon Trajet smartphone application developed by <a href="https://brisksynergies.com/">Brisk Synergies Inc</a>. The precise duration of the time period is kept confidential.</p>
<p><code>tripset</code> is used to explore methods offered in this package. Data similar to <code>tripset</code> can be generated using other sources of GPS data, however, a preprocessing stage is necessary to map-match and aggregate the information up to the road segment (link) level. Such preprocessing is already performed on <code>tripset</code>.</p>
<p><code>traveltimeHMM</code> does not perform this preprocessing stage, and the software cannot make use of raw GPS data.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(traveltimeHMM)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(tripset)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(tripset)</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co">#&gt;   tripID linkID timeBin logspeed traveltime    length                time</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co">#&gt; 1   2700  10469 Weekday 1.692292  13.000000  70.61488 2014-04-28 06:07:27</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co">#&gt; 2   2700  10444 Weekday 2.221321  18.927792 174.50487 2014-04-28 06:07:41</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="co">#&gt; 3   2700  10460 Weekday 2.203074   8.589937  77.76295 2014-04-28 06:07:58</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="co">#&gt; 4   2700  10462 Weekday 1.924290  14.619859 100.15015 2014-04-28 06:08:07</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="co">#&gt; 5   2700  10512 Weekday 1.804293   5.071986  30.81574 2014-04-28 06:08:21</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="co">#&gt; 6   2700   5890 Weekday 2.376925  31.585355 340.22893 2014-04-28 06:08:26</span></a></code></pre></div>
<p>Travel data is organized around the notions of <em>trips</em> and <em>links</em>. Links are road segments each with well-defined beginning and end points and which can be traversed. A vehicle performs a trip when it travels from a start point to an end point through a sequence of links. Thus trips can be considered as ordered sequences of links. <code>tripset</code> includes data for a collection of trips.</p>
<ul>
<li><p>Field <code>tripID</code> contains each <em>trip</em>’s ID, whereas field <code>linkID</code> contains the IDs of each <em>link</em> making up a trip. Both fields need to be numerical. It is assumed that, in the data set, all trips are grouped together and all links of a given trip appear in the order in which they are traversed (No verification is performed to that effect). A given link corresponds to some physical entity such as a road segment, a portion of a road segment, or any combination of those. Hence, it is expected that links are used in more than one trip.</p></li>
<li><p>Field <code>timeBin</code> (character string, or factor) refers to the time “category” when the traversal of a given link occurred. Time bins should reflect as much as possible time periods of the week encompassing similar traffic classes. In <code>tripset</code> we define five time bins: <code>Weekday</code>, <code>MorningRush</code>, <code>EveningRush</code>, <code>EveningNight</code> and <code>Weekendday</code>.</p></li>
</ul>
<table class="table table">
<caption>
Table 1 - Example from <code>tripset</code> : Time bin by period of the week
</caption>
<thead><tr>
<th style="text-align:left;">
Period of the week
</th>
<th style="text-align:left;">
Time bin
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Mon - Fri outside rush hour
</td>
<td style="text-align:left;">
Weekday
</td>
</tr>
<tr>
<td style="text-align:left;">
Mon - Fri, 7AM - 9AM
</td>
<td style="text-align:left;">
MorningRush
</td>
</tr>
<tr>
<td style="text-align:left;">
Mon - Fri, 3PM - 6PM
</td>
<td style="text-align:left;">
EveningRush
</td>
</tr>
<tr>
<td style="text-align:left;">
Sat 9AM - 9PM + Sun 9AM - 7PM
</td>
<td style="text-align:left;">
Weekendday
</td>
</tr>
<tr>
<td style="text-align:left;">
Sat - Sun otherwise
</td>
<td style="text-align:left;">
EveningNight
</td>
</tr>
</tbody>
</table>
<ul>
<li><p>Field <code>logspeed</code> contains the natural logarithm of the <em>speed</em> (in meter/second) of traversal of each link. This information is central to the estimation algorithm.</p></li>
<li><p>Field <code>traveltime</code> refers to the traversal time (in seconds) of each link. This field is mostly for reference and is not used directly in the package.</p></li>
<li><p>Field <code>length</code> refers to the length (in meters) of each link. This information is used by the prediction algorithm.</p></li>
<li><p>Field <code>time</code> gives the entry time in POSIXct format for the traversal of a given link. Individual datums are not used directly; however, the start time of the very first traversal is likely to be useful for providing the start time of a whole trip to the prediction function. Field <code>time</code> determine the time bin for each link, as illustrated in Table 1.</p></li>
</ul>
<p><code>traveltimeHMM</code> includes functionality to convert time stamps to alternative time bins, please refer to <a href="Time%20bins">Time bins</a>.</p>
</div>
<div id="statistical-models" class="section level1">
<h1 class="hasAnchor">
<a href="#statistical-models" class="anchor"></a>Statistical models</h1>
<p>At the core of <code>traveltimeHMM</code> is a statistical model that aims to approximate the distribution of travel time over a combination of <em>links</em> and a <em>start time</em>, on the basis of data just like that we just described. <code>traveltimeHMM</code> includes multiple models, including the ones in Woodard et. al. (2016). The following sections describe each model implementation.</p>
<div id="woodard-models" class="section level2">
<h2 class="hasAnchor">
<a href="#woodard-models" class="anchor"></a>Woodard Models</h2>
<p>Woodard et. al. (2016) models are built around an HMM construction. The most general model is the <code>trip-HMM</code>, which estimates the mean and standard deviation of the <em>speed</em> for each combination of road link, time bin, and congestion state. This latter concept involve defining a finite number of <em>hidden states</em> that reflect traffic fluidity of a trip at a given place and time. For instance the fact that one is driving downtown during rush hour (or not), they might (or might not) fall into congestion at a specific link and time. Hence, congestion level as a property of the individual trip, rather than a property of the link and time. In our example, we chose to define two congestion states which we implicitly call “congested” and “not-congested”.</p>
<p>In order to deal properly with the fact that the congestion states are unobserved, the model estimates parameters for each hidden state. These estimates are computed using a Markov model and Viterbi forward-backward algorithm. To capture variability in speed due to trip-specific conditions (e.g. driver habits), the model also estimates a random <em>trip effect</em>.</p>
<p>Let <span class="math inline">\(T_{i,k}\)</span> be the travel time of trip <span class="math inline">\(i\)</span> on road <span class="math inline">\(R_k\)</span>, here <span class="math inline">\(R_k\)</span> is the unique road in the map representing the <span class="math inline">\(k\)</span>-th traversed road on the travel path of trip <span class="math inline">\(i\)</span>, such that</p>
<p><span class="math display">\[T_{i,k} = \frac{d_{i,k}}{E_iS_{i,k}}, \quad i \in I, k \in \{1, \dots, n_i\},\]</span></p>
<p>where <span class="math inline">\(S_{i,k}\)</span> is the trip’s <span class="math inline">\(i\)</span> speed on link <span class="math inline">\(k\)</span> of length <span class="math inline">\(d_{i,k}\)</span>, and <span class="math inline">\(E_i\)</span> is the driver specific random effect, which is modelled as</p>
<p><span class="math display">\[\log E_i \sim N(0, \tau^2).\]</span></p>
<p>The speed distribution is modelled as a log-normal, with parameters <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span>, as <span class="math display">\[\log S_{i,k}\mid Q_{i,k} \sim N( \mu_{R_{i,k}, b_{i,k}, Q_{i,k}},  \sigma^2_{R_{i,k}, b_{i,k}, Q_{i,k}}) , \quad \text{with} \quad \mu_{j,b,q-1} \leq \mu_{j,b,q}\]</span> where <span class="math inline">\(N\)</span> is the normal distribution, and <span class="math inline">\(Q_{i,k}\)</span> is a hidden state representing congestion, <span class="math inline">\(b_{i,k} \in B\)</span> is a set of time bins on link <span class="math inline">\(k\)</span>.</p>
<p>The transition states are defined as <span class="math display">\[P(Q_{i,1}=q) =  \gamma_{R_{i,1}, b_{i,1}} (q)\]</span> <span class="math display">\[P (Q_{i,k}= q \mid Q_{i,k-1}=q') = \Gamma_{R_{i,k}, b_{i,k}} (q',q)\]</span></p>
<div id="variants" class="section level3">
<h3 class="hasAnchor">
<a href="#variants" class="anchor"></a>Variants</h3>
<p>The other three models are special cases of <code>trip-HMM</code> described above.</p>
<p>The <code>HMM</code> model, which is the default, assumes that the trip effect is fixed to 1 (<span class="math inline">\(E_i=1\)</span>). The <code>trip</code> model considers the existence of a single traffic state (does not use the hidden states abstraction); under this model the parameters <span class="math inline">\(\gamma\)</span> and <span class="math inline">\(\Gamma\)</span> remain undefined. Finally, the <code>no-dependence</code> model is the most basic of the four, assumes no trip effect and no hidden Markov states. Table 2 provides a summary of the characteristics of each model.</p>
<table class="table table">
<caption>
Model typology
</caption>
<thead><tr>
<th style="text-align:left;">
Model type
</th>
<th style="text-align:center;">
Hidden Markov model (<code>HMM</code>)
</th>
<th style="text-align:center;">
Trip effect model (<code>trip</code>)
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;width: 4cm; ">
trip-HMM
</td>
<td style="text-align:center;width: 3cm; ">
YES
</td>
<td style="text-align:center;width: 3cm; ">
YES
</td>
</tr>
<tr>
<td style="text-align:left;width: 4cm; ">
HMM (default)
</td>
<td style="text-align:center;width: 3cm; ">
YES
</td>
<td style="text-align:center;width: 3cm; ">
NO
</td>
</tr>
<tr>
<td style="text-align:left;width: 4cm; ">
trip
</td>
<td style="text-align:center;width: 3cm; ">
NO
</td>
<td style="text-align:center;width: 3cm; ">
YES
</td>
</tr>
<tr>
<td style="text-align:left;width: 4cm; ">
no-dependence
</td>
<td style="text-align:center;width: 3cm; ">
NO
</td>
<td style="text-align:center;width: 3cm; ">
NO
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="model-estimation" class="section level1">
<h1 class="hasAnchor">
<a href="#model-estimation" class="anchor"></a>Model estimation</h1>
<p>Model estimation is performed using Algorithm 1 of Woodard et al. (2016) The estimation algorithm takes input data on speeds (on a logarithmic scale), trips, road links and time periods, and calculates a set of parameter estimates for a specified model.</p>
<p>Calculations are performed iteratively as is typical of non-linear optimization algorithms. The estimates for each parameter are updated at each iteration, and the algorithm stops when either the variation in parameter estimates between two successive iterations is below a predefined threshold value, or a predefined maximum number of iterations is reached.</p>
<div id="calling-traveltimehmm" class="section level2">
<h2 class="hasAnchor">
<a href="#calling-traveltimehmm" class="anchor"></a>Calling <code>traveltimeHMM</code>
</h2>
<p>The estimation algorithm can be executed by calling the <code>traveltimeHMM</code> function. The function’s interface is as follows.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw"><a href="../reference/traveltimeHMM.html">traveltimeHMM</a></span>(<span class="dt">logspeeds =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb2-2" title="2">              <span class="dt">trips =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb2-3" title="3">              <span class="dt">timeBins =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb2-4" title="4">              <span class="dt">linkIds =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb2-5" title="5">              <span class="dt">data =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb2-6" title="6">              <span class="dt">nQ =</span> 1L,</a>
<a class="sourceLine" id="cb2-7" title="7">              <span class="dt">model =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"HMM"</span>, <span class="st">"trip-HMM"</span>, <span class="st">"trip"</span>, <span class="st">"no-dependence"</span>),</a>
<a class="sourceLine" id="cb2-8" title="8">              <span class="dt">tol.err =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb2-9" title="9">              <span class="dt">L =</span> 10L,</a>
<a class="sourceLine" id="cb2-10" title="10">              <span class="dt">max.it =</span> <span class="dv">20</span>,</a>
<a class="sourceLine" id="cb2-11" title="11">              <span class="dt">verbose =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb2-12" title="12">              <span class="dt">max.speed =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb2-13" title="13">              <span class="dt">seed =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb2-14" title="14">              <span class="dt">tmat.p =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb2-15" title="15">              <span class="dt">init.p =</span> <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb2-16" title="16">              </a></code></pre></div>
<p><code>traveltimeHMM</code> can be called either using <em>explicit parameters</em> or using a <em>composite object</em> incorporating the main parameters, for example, a <code>data.frame</code>.</p>
<p>Explicit calling is as</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">fit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/traveltimeHMM.html">traveltimeHMM</a></span>(<span class="dt">logspeeds =</span> tripset<span class="op">$</span>logspeed,</a>
<a class="sourceLine" id="cb3-2" title="2">                     <span class="dt">trips =</span> tripset<span class="op">$</span>tripID,</a>
<a class="sourceLine" id="cb3-3" title="3">                     <span class="dt">timeBins =</span> tripset<span class="op">$</span>timeBin,</a>
<a class="sourceLine" id="cb3-4" title="4">                     <span class="dt">linkIds =</span> tripset<span class="op">$</span>linkID,</a>
<a class="sourceLine" id="cb3-5" title="5">                     <span class="dt">nQ =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb3-6" title="6">                     <span class="dt">max.it =</span> <span class="dv">20</span>,</a>
<a class="sourceLine" id="cb3-7" title="7">                     <span class="dt">model =</span> <span class="st">"HMM"</span>) <span class="co"># this is the default value</span></a></code></pre></div>
<p>Or using the <code>tripset</code> <code>data.frame</code> as</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">fit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/traveltimeHMM.html">traveltimeHMM</a></span>(<span class="dt">data =</span> tripset,<span class="dt">nQ =</span> <span class="dv">2</span>,<span class="dt">max.it =</span> <span class="dv">20</span>, <span class="dt">model =</span> <span class="st">"HMM"</span>)</a></code></pre></div>
<p>Table 3 provides a description for each parameter.</p>
<table class="table">
<caption>
Table 3 - Parameters for <code>traveltimeHMM</code>
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
<code>logspeeds</code>
</td>
<td style="text-align:left;">
A numeric vector of speed observations (in km/h) on the (natural) log-scale. Needs to be provided if and only if <code>tripframe</code> is NULL. Default is NULL.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>trips</code>
</td>
<td style="text-align:left;">
An integer or character vector of trip ids for each observation of <code>speed</code>. Needs to be provided if and only if <code>tripframe</code> is NULL. Default is NULL.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>timeBins</code>
</td>
<td style="text-align:left;">
A character vector of time bins for each observation of <code>speed</code>. Needs to be provided if and only if <code>tripframe</code> is NULL. Default is NULL.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>linkIds</code>
</td>
<td style="text-align:left;">
A vector of link ids (route or way) for each observation of <code>speed</code>. Needs to be provided if and only if <code>tripframe</code> is NULL. Default is NULL.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>data</code>
</td>
<td style="text-align:left;">
A data frame or equivalent object that contains one column for each of test. Default is NULL. Mutually exclusive with the full joint set of <code>logspeeds</code>, <code>trips</code>, <code>timeBins</code> and <code>linkIds</code>.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>nQ</code>
</td>
<td style="text-align:left;">
An integer corresponding to the number of different congestion states that the traversal of a given link can take corresponding to <code>{1, ..., Q}</code>. Models of the HMM family require <code>nQ &gt;= 2</code> whilst other models require exactly <code>nQ=1</code>. Default is <code>1</code>.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>model</code>
</td>
<td style="text-align:left;">
Type of model as string. Can take one of ‘<code>trip-HMM</code>’, ‘<code>HMM</code>’, ‘<code>trip</code>’ or ‘<code>no-dependence</code>’. Default is ‘<code>HMM</code>’. See Table 3 for details.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>tol.err</code>
</td>
<td style="text-align:left;">
A numeric variable representing the threshold under which the estimation algorithm will consider it has reached acceptable estimate values. Default is <span class="math inline">\(10\)</span>.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>L</code>
</td>
<td style="text-align:left;">
An integer minimum number of observations per factor (<code>linkIds</code> x <code>timeBins</code>) to estimate the parameter for. Default is <span class="math inline">\(10\)</span>. See section on imputation below.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>max.it</code>
</td>
<td style="text-align:left;">
An integer for the upper limit of the iterations to be performed by the estimation algorithm. Default is 20.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>verbose</code>
</td>
<td style="text-align:left;">
A boolean that triggers verbose output. Default is <code>FALSE</code>.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>max.speed</code>
</td>
<td style="text-align:left;">
An optional float for the maximum speed in km/h, on the linear scale (not the log-scale, unlike for <code>logspeeds</code>). Default is <code>NULL</code> which in practice results in a maximum speed of 130 km/h.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>seed</code>
</td>
<td style="text-align:left;">
An optional float for the seed used for the random generation of the first Markov transition matrix and initial state vector. Default is <code>NULL</code>. If not provided, then those objects are generated deterministically. The effect of <code>seed</code> is cancelled by tmat.p or init.p when provided.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>tmat.p</code>
</td>
<td style="text-align:left;">
An optional Markov transition matrix <span class="math inline">\(\Gamma\)</span> of size <code>nQ</code> <code>nQ</code> with rows summing to <span class="math inline">\(1\)</span>. Default is <code>NULL</code>. See section on Markov transition matrix and initial state vector below.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>init.p</code>
</td>
<td style="text-align:left;">
An optional Markov initial state vector <span class="math inline">\(\gamma\)</span> of size <code>nQ</code> with elements summing to <span class="math inline">\(1\)</span>. Default is <code>NULL</code>. See section on Markov transition matrix and initial state vector below.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>debug</code>
</td>
<td style="text-align:left;">
A boolean with value <code>TRUE</code> if we want debug information to be generated. Default is <code>FALSE</code>.
</td>
</tr>
</tbody>
</table>
</div>
<div id="markov-transition-matrix-and-initial-state-vector" class="section level2">
<h2 class="hasAnchor">
<a href="#markov-transition-matrix-and-initial-state-vector" class="anchor"></a>Markov transition matrix and initial state vector</h2>
<p>If provided and valid, parameters <code>tmat.p</code> and <code>init.p</code> will be used as initial values for <span class="math inline">\(\Gamma\)</span> and <span class="math inline">\(\gamma\)</span>. Otherwise, the algorithm will assume initial probabilities to be uniform, as <span class="math inline">\(\Gamma^{(0)}_{i,b} = 1/nQ\)</span>, and <span class="math inline">\(\gamma_{j,b}^{(0)} = 1/nQ\)</span>. Each row and column of <span class="math inline">\(\Gamma\)</span> and each row of <span class="math inline">\(\gamma\)</span> correspond to different congestion states <span class="math inline">\(q_1,q_2,....\)</span> Given <span class="math inline">\(j\)</span> and <span class="math inline">\(b\)</span>, <span class="math inline">\(\Gamma_{row,col|j,b}\)</span> represents the probability of reaching state <span class="math inline">\(q_{col}\)</span> from state <span class="math inline">\(q_{row}\)</span>, whilst <span class="math inline">\(\gamma_{row|j,b}\)</span> represents the probability of beginning a trip with state <span class="math inline">\(q_{row}\)</span>.</p>
</div>
<div id="a-word-on-imputation" class="section level2">
<h2 class="hasAnchor">
<a href="#a-word-on-imputation" class="anchor"></a>A word on imputation</h2>
<p>The implementation allows imputing for combinations of road links and time bins, for which the lack of sufficient observations prevents reliable parameter estimation. When imputation is required for a given combination, estimates for <span class="math inline">\(\mu\)</span>, <span class="math inline">\(\sigma\)</span>, <span class="math inline">\(\Gamma\)</span> and <span class="math inline">\(\gamma\)</span> are calculated on the basis of data available for the time bin involved <em>for all road links</em>.</p>
<p>This approach differs from the one in Woodard et.al.(2016), where imputation is performed on the basis of road classification data (e.g. “arterial” or “primary collector road”). This implementation does not handle road classification data.</p>
<p>Imputation is performed in the following three cases:</p>
<ul>
<li><p>Case 1: when a combination (<code>links x timebins</code>) has fewer than <code>L</code> <em>total observations</em>;</p></li>
<li><p>Case 2: when a combination has fewer than <code>L</code> <em>initial state observations only</em>;</p></li>
<li><p>Case 3: when a combination has only initial states.</p></li>
</ul>
<p>The number of observations specified in parameter <code>L</code> determines the threshold below which imputation occurs for cases 1 and 2.</p>
</div>
<div id="execution-user-messages" class="section level2">
<h2 class="hasAnchor">
<a href="#execution-user-messages" class="anchor"></a>Execution user messages</h2>
<p>Below is some typical output from executing <code>travetimeHMM</code>. One can find:</p>
<ul>
<li>the maximum speed on the road network;</li>
<li>the number of trips, road links and time bins;</li>
<li>the number of iterations to be executed;</li>
<li>an estimate of the total execution time, based on the time it takes for executing a first iteration.</li>
</ul>
<p>For example:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="co">#&gt; max.speed is not specified, setting at default value: 130 km/h</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="co">#&gt; Model HMM with 4914 trips over 13235 roads and 5 time bins...</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="co">#&gt; Expected completion of 20 iterations in 105 secs</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="co">#&gt; Reached maximum number of iterations</span></a></code></pre></div>
</div>
<div id="return-values" class="section level2">
<h2 class="hasAnchor">
<a href="#return-values" class="anchor"></a>Return values</h2>
<p>The execution of <code>traveltimeHMM</code> returns a list of the parameters in Table 4.</p>
<table class="table">
<caption>
Table 4 - Components of the list object returned by <code>traveltimeHMM</code>
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
<code>factors</code>
</td>
<td style="text-align:left;">
A factor of interactions (<code>linkIds</code> x <code>timeBins</code>) of length <code>nObs</code>. Factors are in the format ‘linkId.timeBin’.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>trip</code>
</td>
<td style="text-align:left;">
A factor of trip IDs.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>tmat</code>
</td>
<td style="text-align:left;">
A transition matrix with rows corresponding to <code><a href="https://www.rdocumentation.org/packages/base/topics/levels">levels(factors)</a></code>, and with columns being the row-wise transition matrix of that factor. For example, <code><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix(tmat[1,], ncol = nQ, nrow = nQ, byrow = TRUE)</a></code> is the transition matrix <span class="math inline">\(\hat{\Gamma}\)</span> of <code>levels(factors)[1]</code>. NULL if hidden Markov modelling is not handled by the selected model type.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>init</code>
</td>
<td style="text-align:left;">
An initial state probability matrix with rows corresponding to <code><a href="https://www.rdocumentation.org/packages/base/topics/levels">levels(factors)</a></code>, and columns to the <code>nQ</code> states. For example, <code>init[1,]</code> gives <span class="math inline">\(\hat{\gamma}^\top\)</span> for <code>levels(factors)[1]</code>. NULL if hidden Markov modelling is not handled by the selected model type.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>sd</code>
</td>
<td style="text-align:left;">
A matrix of standard deviations estimates for the natural logarithm of the speed (in km/h), with rows corresponding to <code><a href="https://www.rdocumentation.org/packages/base/topics/levels">levels(factors)</a></code>, and columns to standard deviation estimates <span class="math inline">\(\hat{\sigma}\)</span> for the <code>nQ</code> states.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>mean</code>
</td>
<td style="text-align:left;">
A matrix of mean estimates for the natural logarithm of the speed (in km/h), with rows corresponding to <code><a href="https://www.rdocumentation.org/packages/base/topics/levels">levels(factors)</a></code>, and columns to mean estimates <span class="math inline">\(\hat{\sigma}\)</span> for the <code>nQ</code> states. Speed
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>tau</code>
</td>
<td style="text-align:left;">
A numeric variable for the standard deviation estimate <span class="math inline">\(\hat{\tau}\)</span> for the trip effect <span class="math inline">\(\log(E)\)</span>. Equals <span class="math inline">\(1\)</span> if trip effect is not handled by the selected model type.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>logE</code>
</td>
<td style="text-align:left;">
A numeric vector of trip effect estimates <span class="math inline">\(\log(\hat{E})\)</span> corresponding to <code><a href="https://www.rdocumentation.org/packages/base/topics/levels">levels(trip)</a></code>. Values are set to <span class="math inline">\(0\)</span> if trip effect is not handled by the selected model type. Units are the same as for <code>logspeeds</code>.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>nQ</code>
</td>
<td style="text-align:left;">
An integer corresponding to the number of different congestion states, equal to the parameter <code>nQ</code> that was passed in the function call.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>nB</code>
</td>
<td style="text-align:left;">
An integer corresponding to the number of unique time bins.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>nObs</code>
</td>
<td style="text-align:left;">
An integer corresponding to the number of observations.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>model</code>
</td>
<td style="text-align:left;">
Type of model as string. Same as parameter <code>model</code> that was passed in the function call.
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="prediction" class="section level1">
<h1 class="hasAnchor">
<a href="#prediction" class="anchor"></a>Prediction</h1>
<p>Prediction is performed using Algorithm 2 from Woodard et. al. (2016). Prediction is obtained by sequential sampling on the basis of the parameter estimates supplied to the algorithm. First, given a start time, the algorithm samples initial states for the first link and time bin, a long side speed. For every subsequent link, samples a new state, given the previous link states, and speed on the link given the state and time bin. Travel time is then aggregated and computed deterministically. Ultimately <span class="math inline">\(n\)</span> point predictions are returned for the travel time (in seconds) of the whole trip.</p>
<div id="calling-predict-traveltime-or-predict" class="section level2">
<h2 class="hasAnchor">
<a href="#calling-predict-traveltime-or-predict" class="anchor"></a>Calling <code>predict.traveltime</code> or <code>predict</code>
</h2>
<p>The prediction algorithm is executed by calling the <code>predict.traveltime</code>, or equivalently the <code>S3</code> method <code>predict</code>, which has the following interface:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(object,</a>
<a class="sourceLine" id="cb6-2" title="2">        tripdata,</a>
<a class="sourceLine" id="cb6-3" title="3">        <span class="dt">starttime =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Sys.time">Sys.time</a></span>(),</a>
<a class="sourceLine" id="cb6-4" title="4">        <span class="dt">n =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb6-5" title="5">        <span class="dt">logE =</span> <span class="ot">NULL</span>)</a></code></pre></div>
<p>If <code>logE = NULL</code> then the default value of <code>logE=1</code> is used.</p>
<p>Our example involves predicting the travel time for trip ID 2700 from the original data set, using the model parameters we just estimated. We need to manually supply the start time by taking the very first link’s time stamp. Choosing <code>n = 1000</code> to generate 1000 travel time predictions for the whole trip.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="co"># Extracting link traversal data for trip ID 2700.</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="co"># Link traversal order is preserved.</span></a>
<a class="sourceLine" id="cb7-3" title="3">single_trip &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/subset">subset</a></span>(tripset, tripID<span class="op">==</span><span class="dv">2700</span>)</a>
<a class="sourceLine" id="cb7-4" title="4"></a>
<a class="sourceLine" id="cb7-5" title="5">pred &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(<span class="dt">object =</span> fit, <span class="dt">tripdata =</span> single_trip,</a>
<a class="sourceLine" id="cb7-6" title="6">               <span class="dt">starttime =</span> single_trip<span class="op">$</span>time[<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb7-7" title="7">               <span class="dt">n =</span> <span class="dv">1000</span>)</a></code></pre></div>
<p>Table 5 provides a description for each parameter.</p>
<table class="table">
<caption>
Table 5 - Parameters for <code>predict.traveltime</code>
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
<code>object</code>
</td>
<td style="text-align:left;">
A list object corresponding to the return value of function <code>traveltimeHMM</code>.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>tripdata</code>
</td>
<td style="text-align:left;">
A data frame of road links with information on each link’s traversal. Columns minimally includes objects <code>linkID</code> and <code>length</code>, and the latter must have the same length. Rows must be in chronological order.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>starttime</code>
</td>
<td style="text-align:left;">
The start date and time for the very first link of the trip, in <code>POSIXct</code> format. Default is the current date and time.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>n</code>
</td>
<td style="text-align:left;">
Number of samples. Default is <span class="math inline">\(1000\)</span>.
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>logE</code>
</td>
<td style="text-align:left;">
A numeric representing the point estimate of the mean trip effect for the speed in km/h, on the log-scale. (Hence, speeds and trip effects are to be added <em>on the logarithmic scale</em> as prescribed in Woodard et al.) <code>logE</code> normally needs to be a numerical vector of size <code>nSamples</code>. If a single numeric value is supplied, it will be replicated into a vector. If <code>logE</code> is <code>NULL</code> the function will use either a vector of simulated values (if the model is from the trip family), or a vector of <span class="math inline">\(0\)</span> otherwise. Default is NULL. NOTE: when simulating values for the vector, the value for <span class="math inline">\(\tau\)</span> is taken from the model object.
</td>
</tr>
</tbody>
</table>
</div>
<div id="return-values-1" class="section level2">
<h2 class="hasAnchor">
<a href="#return-values-1" class="anchor"></a>Return values</h2>
<p><code>predict.traveltime</code> returns a numerical vector of size <code>n</code> representing the point prediction of total travel time, in seconds, for each run.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(pred)</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="co">#&gt; [1]  893.3512  709.5116  672.9112 1095.5728  671.7145  668.2191</span></a></code></pre></div>
<p>Figure 1 shows the travel time distribution thus obtained. The observed travel time for the same trip in the data set is 887.73 seconds, whilst the mean of the 1000 predictions for our simulation was 861.26 seconds.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(pred, <span class="dt">freq =</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb9-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/abline">abline</a></span>(<span class="dt">v =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(pred), <span class="dt">lty=</span><span class="dv">2</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb9-3" title="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/abline">abline</a></span>(<span class="dt">v=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(single_trip<span class="op">$</span>traveltime), <span class="dt">lty=</span><span class="dv">2</span>, <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">col=</span><span class="st">'red'</span>)</a></code></pre></div>
<div class="figure">
<img src="traveltimeHMM_files/figure-html/unnamed-chunk-15-1.png" alt="Figure 1 - Travel time distribution for trip ID 2700 for 1 000 runs using the test data set with an HMM model." width="432"><p class="caption">
Figure 1 - Travel time distribution for trip ID 2700 for 1 000 runs using the test data set with an HMM model.
</p>
</div>
</div>
</div>
<div id="model-type-comparison" class="section level1">
<h1 class="hasAnchor">
<a href="#model-type-comparison" class="anchor"></a>Model type comparison</h1>
<p>Figure 2 shows the histograms of travel time for each of the four models for the same example.</p>
<div class="figure">
<img src="traveltimeHMM_files/figure-html/unnamed-chunk-16-1.png" alt="Figure 2 - Comparison of travel time distribution for the four model types for the same example." width="576"><p class="caption">
Figure 2 - Comparison of travel time distribution for the four model types for the same example.
</p>
</div>
</div>
<div id="time-bins" class="section level1">
<h1 class="hasAnchor">
<a href="#time-bins" class="anchor"></a>Time bins</h1>
<p>To specify different time bins than the ones supplied, <code>traveltimeHMM</code> provides a functional method called <code><a href="../reference/rules2timebins.html">rules2timebins()</a></code> that translates human readable weekly time bins to a conversion function.</p>
<p><code><a href="../reference/rules2timebins.html">rules2timebins()</a></code> takes a list of lists of time bin rules, where each sub-list specifies 4 variables, <code>start</code> and <code>end</code>as the start and end time of a time bin in 24h format, <code>days</code> as a vector specifying the weekdays this time bin applies to, <code>1</code> for Sunday, and <code>2:5</code> for weekdays, and finally a <code>tag</code> to specify a name for the time bin.</p>
<p>For example,</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">rules =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(</a>
<a class="sourceLine" id="cb10-2" title="2">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">start=</span><span class="st">'6:30'</span>,  <span class="dt">end=</span> <span class="st">'9:00'</span>,  <span class="dt">days =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">tag=</span><span class="st">'MR'</span>),</a>
<a class="sourceLine" id="cb10-3" title="3">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">start=</span><span class="st">'15:00'</span>, <span class="dt">end=</span> <span class="st">'18:00'</span>, <span class="dt">days =</span> <span class="dv">2</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">tag=</span><span class="st">'ER'</span>)</a>
<a class="sourceLine" id="cb10-4" title="4">)</a></code></pre></div>
<p>specifies two time bins calls <code>MR</code> for morning rush, and <code>ER</code> for evening rush, the former is for all weekdays and the latter is for Tuesdays to Fridays. All other time intervals are assigned a time bin called <code>Other</code>.</p>
<p>Passing <code>rules</code> to <code><a href="../reference/rules2timebins.html">rules2timebins()</a></code> would return an easy to use functional, for example</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">time_bins &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rules2timebins.html">rules2timebins</a></span>(rules)</a>
<a class="sourceLine" id="cb11-2" title="2"><span class="kw"><a href="../reference/time_bins.html">time_bins</a></span>(<span class="st">"2019-08-16 15:25:00 EDT"</span>) <span class="co">## Friday</span></a>
<a class="sourceLine" id="cb11-3" title="3">[<span class="dv">1</span>] <span class="st">"ER"</span></a>
<a class="sourceLine" id="cb11-4" title="4"><span class="kw"><a href="../reference/time_bins.html">time_bins</a></span>(<span class="st">"2019-08-17 21:25:58 EDT"</span>) <span class="co">## Saturday</span></a>
<a class="sourceLine" id="cb11-5" title="5">[<span class="dv">1</span>] <span class="st">"Other"</span></a></code></pre></div>
<p>To change the time bins in <code>tripset</code>, run the code</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">tripset<span class="op">$</span>timeBin &lt;-<span class="st"> </span><span class="kw"><a href="../reference/time_bins.html">time_bins</a></span>(tripset<span class="op">$</span>time)</a>
<a class="sourceLine" id="cb12-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(tripset)</a>
<a class="sourceLine" id="cb12-3" title="3">  tripID linkID timeBin logspeed traveltime    length                time</a>
<a class="sourceLine" id="cb12-4" title="4"><span class="dv">1</span>   <span class="dv">2700</span>  <span class="dv">10469</span>   Other <span class="fl">1.692292</span>  <span class="fl">13.000000</span>  <span class="fl">70.61488</span> <span class="dv">2014-04-28</span> <span class="dv">06</span><span class="op">:</span><span class="dv">07</span><span class="op">:</span><span class="dv">27</span></a>
<a class="sourceLine" id="cb12-5" title="5"><span class="dv">2</span>   <span class="dv">2700</span>  <span class="dv">10444</span>   Other <span class="fl">2.221321</span>  <span class="fl">18.927792</span> <span class="fl">174.50487</span> <span class="dv">2014-04-28</span> <span class="dv">06</span><span class="op">:</span><span class="dv">07</span><span class="op">:</span><span class="dv">41</span></a>
<a class="sourceLine" id="cb12-6" title="6"><span class="dv">3</span>   <span class="dv">2700</span>  <span class="dv">10460</span>   Other <span class="fl">2.203074</span>   <span class="fl">8.589937</span>  <span class="fl">77.76295</span> <span class="dv">2014-04-28</span> <span class="dv">06</span><span class="op">:</span><span class="dv">07</span><span class="op">:</span><span class="dv">58</span></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="dv">4</span>   <span class="dv">2700</span>  <span class="dv">10462</span>   Other <span class="fl">1.924290</span>  <span class="fl">14.619859</span> <span class="fl">100.15015</span> <span class="dv">2014-04-28</span> <span class="dv">06</span><span class="op">:</span><span class="dv">08</span><span class="op">:</span><span class="dv">07</span></a>
<a class="sourceLine" id="cb12-8" title="8"><span class="dv">5</span>   <span class="dv">2700</span>  <span class="dv">10512</span>   Other <span class="fl">1.804293</span>   <span class="fl">5.071986</span>  <span class="fl">30.81574</span> <span class="dv">2014-04-28</span> <span class="dv">06</span><span class="op">:</span><span class="dv">08</span><span class="op">:</span><span class="dv">21</span></a>
<a class="sourceLine" id="cb12-9" title="9"><span class="dv">6</span>   <span class="dv">2700</span>   <span class="dv">5890</span>   Other <span class="fl">2.376925</span>  <span class="fl">31.585355</span> <span class="fl">340.22893</span> <span class="dv">2014-04-28</span> <span class="dv">06</span><span class="op">:</span><span class="dv">08</span><span class="op">:</span><span class="dv">26</span></a></code></pre></div>
<p><em><em>Remark</em></em>: at package loading a default <code><a href="../reference/time_bins.html">time_bins()</a></code> functional is created, which constructs the default time bins of <code>tripset</code>.</p>
<div id="prediction-with-new-time-bins" class="section level2">
<h2 class="hasAnchor">
<a href="#prediction-with-new-time-bins" class="anchor"></a>Prediction with new time bins</h2>
<p>The estimation step <code>traveltimeHMM</code> does not utilize the new functional <code><a href="../reference/time_bins.html">time_bins()</a></code>, however in the prediction stage, predict requires input of the proper time bin functional. This can be seen by the arguments of <code>predict</code> as</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(object, data, <span class="dt">starttime =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Sys.time">Sys.time</a></span>(),  <span class="dt">n=</span><span class="dv">1000</span>, <span class="dt">time_bins.fun =</span> time_bins, ...)</a></code></pre></div>
<p>where the argument <code>time_bins.fun = time_bins</code> is already specified to the default <code><a href="../reference/time_bins.html">time_bins()</a></code> functional. Hence, in prediction under a new time bin categories, the constructed functional must be passed as `time_bins.fun.</p>
<p>In the above example this would require refitting the data and re-predicting as</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">fit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/traveltimeHMM.html">traveltimeHMM</a></span>(<span class="dt">data =</span> tripset,<span class="dt">nQ =</span> <span class="dv">2</span>,<span class="dt">max.it =</span> <span class="dv">20</span>, <span class="dt">model =</span> <span class="st">"HMM"</span>)</a>
<a class="sourceLine" id="cb14-2" title="2"><span class="co">#&gt; Model HMM with 4914 trips over 13235 roads and 3 time bins...</span></a>
<a class="sourceLine" id="cb14-3" title="3"><span class="co">#&gt; Expected completion of 20 iterations in 116 secs</span></a>
<a class="sourceLine" id="cb14-4" title="4"><span class="co">#&gt; Reached maximum number of iterations</span></a>
<a class="sourceLine" id="cb14-5" title="5"></a>
<a class="sourceLine" id="cb14-6" title="6"></a>
<a class="sourceLine" id="cb14-7" title="7">pred &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(<span class="dt">object =</span> fit, <span class="dt">tripdata =</span> single_trip, </a>
<a class="sourceLine" id="cb14-8" title="8">                <span class="dt">starttime =</span> single_trip<span class="op">$</span>time[<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb14-9" title="9">                <span class="dt">n =</span> <span class="dv">1000</span>, <span class="dt">time_bins.fun =</span> time_bins)</a>
<a class="sourceLine" id="cb14-10" title="10"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(pred, <span class="dt">freq=</span><span class="ot">FALSE</span>)</a></code></pre></div>
</div>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<p>Woodard, D., Nogin, G., Koch, P., Racz, D., Goldszmidt, M., Horvitz, E., 2017. “Predicting travel time reliability using mobile phone GPS data”. <em>Transportation Research Part C</em>, 75, 30-44. <a href="http://dx.doi.org/10.1016/j.trc.2016.10.011" class="uri">http://dx.doi.org/10.1016/j.trc.2016.10.011</a></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#example-data-set-tripset">Example data set: <code>tripset</code></a></li>
      <li>
<a href="#statistical-models">Statistical models</a><ul class="nav nav-pills nav-stacked">
<li><a href="#woodard-models">Woodard Models</a></li>
      </ul>
</li>
      <li>
<a href="#model-estimation">Model estimation</a><ul class="nav nav-pills nav-stacked">
<li><a href="#calling-traveltimehmm">Calling <code>traveltimeHMM</code></a></li>
      <li><a href="#markov-transition-matrix-and-initial-state-vector">Markov transition matrix and initial state vector</a></li>
      <li><a href="#a-word-on-imputation">A word on imputation</a></li>
      <li><a href="#execution-user-messages">Execution user messages</a></li>
      <li><a href="#return-values">Return values</a></li>
      </ul>
</li>
      <li>
<a href="#prediction">Prediction</a><ul class="nav nav-pills nav-stacked">
<li><a href="#calling-predict-traveltime-or-predict">Calling <code>predict.traveltime</code> or <code>predict</code></a></li>
      <li><a href="#return-values-1">Return values</a></li>
      </ul>
</li>
      <li><a href="#model-type-comparison">Model type comparison</a></li>
      <li>
<a href="#time-bins">Time bins</a><ul class="nav nav-pills nav-stacked">
<li><a href="#prediction-with-new-time-bins">Prediction with new time bins</a></li>
      </ul>
</li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Mohamad Elmasri.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
